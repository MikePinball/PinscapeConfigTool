<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
   <link rel="stylesheet" href="main.css"/>
   <title>Using a virtual machine for the Firmware Update</title>
</head>
<body>
<h1>
   Using a virtual machine for the firmware update
</h1>

<div>

   <p>
      Yes, I know how crazy it is that you have to find an obsolete
      Windows machine to update a brand new KL25Z.
      Believe me, I wish there were another way,
      but I've searched extensively, and there doesn't seem to be one.
      And I <i>really</i> wish they'd just fix this at the factory, but
      as of mid-2016 they're still shipping this moldy old firmware.
      So we seem to be stuck with this "old Windows" requirement.
   </p>

   <p>
      If you really, truly can't find an XP or Win 7 machine anywhere,
      it's possible, though not easy, to use a <b>virtual machine</b> (VM)
      version of XP or Win 7 running <b>within</b> your <b>current</b> Windows system.
      This doesn't require replacing the OS on your machine, or installing
      another OS alongside it on a new partition or anything like that.
      Instead, you use special software to run the old OS "virtually".
      That means it runs inside a window on your current Windows system.
   </p>
   <p>
      And happily, there's free software (legitimately free and legal)
      available that lets you do this.
   </p>

   <p>
      The downside of the virtual machine procedure is that it's 
      complex and time-consuming.  I'll try to explain it below as best
      I can, but there are parts you'll have to figure out for yourself.
      Please consider this a last resort.  If you really have no other
      options, though, read on.
   </p>

   <p>
      The first thing you should do is <b>print out the instructions</b>
      that the Pinscape config tool displays for doing the firmware update.
      The config tool won't run on XP.  That's okay, because the config
      tool doesn't really do anything during the update process anyway
      except display the instructions.  But you can't run it to view the
      instructions in XP, so you'll want to have a copy handy before you
      start.  To do this, go to the "Set up a new KL25Z" page, click
      past the warning about Windows versions, then click "Show All".
      You can now print the page (there's a button at the bottom
      to do this).  If you have a two-monitor setup, no need to print;
      just leave the instructions on one screen while you run the XP VM
      on the other screen.
   </p>

   <p>
      The next step is to download and install <b>VirtualBox</b>, which
      is a free Virtual Machine manager.  Start here:
      <a target="_blank" href="http://www.virtualbox.org">virtualbox.org<a>.
      Download the latest version and go through the setup procedure to
      install the product on your computer.
   </p>

   <p>
      Now we get to the really time-consuming and difficult part.  You
      need to create an XP or Win 7 VM for VirtualBox.  There are
      basically two options for doing this:
   </p>

   <ul>

      <li><b>With an XP or Win7 install CD:</b>  If you have an old copy
      of XP or 7 on CD, you can use it to install that operating system
      on a new virtual machine.  To do this, run VirtualBox and click
      the "New" button on the toolbar.  Follow the steps to create
      a new VM, selecting the appropriate OS type (XP or 7) from the list
      when asked.  When you start the  machine, you'll be asked to
      insert your Windows boot CD into the CD.  The virtual machine
      will then go through the normal Windows installation procedure.
      It works just like installing Windows on real hardware, and it's
      just as lengthy and tedious.

      <li><b>With a pre-built image:</b>  Microsoft currently provides
      pre-built images of Windows 7 that are designed to allow Web
      developers to test against old versions of IE.  The URL for this
      seems to move around frequently, so I'm going to have you do a Web
      search: "free virtual machines from microsoft".  Look for a
      microsoft.com link in the results - anything else is likely to be
      either a warez site or a third-party tutorial site with a broken
      older link (like I said, Microsoft keeps moving the URLs around).
      The Microsoft page we're looking for is actually a tool for Web
      developers who want to test their sites against old IE versions.
      To make this easier for Web developers, Microsoft provides pre-built
      virtual machines with the old IE versions all set up.  But they'll
      work for our purposes equally well.  You'll be asked to select
      which one you want to download, by selecting an IE version, a
      Windows version, and a "platform".  Select <b>Windows 7</b> or
      earlier for the Windows version.  The IE version doesn't matter.
      Select <b>VirtualBox</b> for the platform.  Once you make your
      selections, the  page should offer you a file to download and
      installation instructions.  Downlaod the file, and read and follow
      the instructions.  You should have a working Windows 7 VM running
      in VirtualBox when you're done.

   </ul>

   <p>
      Once you have your XP/7 virtual machine running, shut it down
      by going to the Start menu within the virtual OS window and
      clicking Turn Off Computer.  Wait for the VM to shut down.
      The VM window will close when it's done.
   </p>

   <p>
      Now go back to the VirtualBox VM manager window.  Right-click
      the VM in the list and select Settings.  In the Settings window,
      select the USB page.  There should be a checkbox at the top labeled
      "Enable USB Controller".  Make sure it's checked.
   </p>

   <p>
      Plug in the KL25Z via the <b>programming</b> port.  Click the
      "+" button next to the "USB Device Filters" list.  You should
      see an entry in the pop-up list starting with "PE Microcomputer Systems Inc".
      That's the KL25Z programming port.  Click it to add it to the
      list.  Click OK.
   </p>

   <p>
      Unplug the KL25Z.
   </p>

   <p>
      Launch the VM by double-clicking it.  Wait for it to finish
      booting.  The XP/Win 7 desktop window should be showing and
      the disk should be done grinding away at startup tasks.
      Now plug in the KL25Z.  If all went well, it should appear
      on the XP/7 desktop and <b>not</b> on your real Windows
      desktop.
   </p>

   <p>
      Now get out that printout we made back at the beginning of
      this whole mess!  Follow the instructions to download and
      install the first .SDA file <b>within the XP/7 box</b>.
   </p>

   <p>
      At this point in the printed instructions, you'll be asked to
      unplug and re-plug the KL25Z.  Things get a little hazy here.
      You <i>might</i> need to add a new VirtualBox USB filter.
      Try re-plugging the KL25Z and see which desktop it connects
      to.  If it connects to the XP/7 desktop, all is good.  If
      it connects to your regular Windows desktop, go to the
      USB device menu in the VirtualBox controls, find the
      un-checked "PE Microcomputer Systems" item, and check it.
      After you check it, unplug the KL25Z and plug it back in.
      This time it will hopefully connect to the XP/7 desktop
      rather than your ordinary desktop.  If not, you might have
      to shut down the VM and repeat the USB Filter process we
      did earlier from the VirtualBox Settings dialog.
   </p>

   <p>
      Once you get through the whole procedure within the XP/7
      VM, disconnect the KL25Z and shut down the VM (Use "Turn off
      computer" from the Start menu within the VM window, and wait
      for the VM window to close).  Now plug the KL25Z back in,
      via the <b>programming</b> port.
   </p>

   <p>
      If all went well, you should have a drive on your Windows
      desktop labeled <b>FRDM-KL25Z</b>.  The drive label is very
      important.  If it's FRDM-KL25Z, everything worked and
      the device should be ready to use in your modern Windows
      version!  If the label <i>isn't</i> FRDM-KL25Z, something
      must have gone wrong somewhere along the way.  Try going
      back through the process above again.  If you can't get it
      to work after carefully repeating all the steps, post on
      vpforums.org and hopefully I or someone else will be able
      to help you troubleshoot.
   </p>
      

</div>

</body>
</html>
